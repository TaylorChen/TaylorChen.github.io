---
layout: default
---

<article class="post">
  <header>
    <h1>{{ page.title }}</h1>
    <p class="post-meta">
      <time datetime="{{ page.date | date_to_xmlschema }}">{{ page.date | date: "%Y-%m-%d" }}</time>
      {% if page.last_modified_at %} · 最后更新于 <time datetime="{{ page.last_modified_at | date_to_xmlschema }}">{{ page.last_modified_at | date: "%Y-%m-%d" }}</time>{% endif %}
      {% if page.categories %} · {{ page.categories | join: ' / ' }}{% endif %}
      {% if page.tags %} · {{ page.tags | join: ', ' }}{% endif %}
    </p>
    <nav class="breadcrumbs" aria-label="Breadcrumb">
      <a href="{{ '/' | relative_url }}">首页</a>
      {% if page.categories and page.categories.size > 0 %}
        {% for c in page.categories %}
          &nbsp;/&nbsp;<a href="{{ '/categories/' | relative_url }}">{{ c }}</a>
        {% endfor %}
      {% endif %}
      &nbsp;/&nbsp;<span aria-current="page">{{ page.title }}</span>
    </nav>
    {% if page.description %}
      <meta name="description" content="{{ page.description | strip_html | strip_newlines | truncate: 160 }}">
    {% endif %}
    {% if page.tags %}
      <meta name="keywords" content="{{ page.tags | join: ', ' }}">
    {% endif %}
  </header>

  <div class="post-body" id="post-body">
    <aside id="toc"></aside>
    <div id="post-content">
      {{ content | replace: '<img', '<img loading="lazy"' }}
    </div>
  </div>

  {% comment %} 相关阅读（按同标签/分类匹配，最多 5 篇） {% endcomment %}
  {% assign related = '' | split: '|' %}
  {% for p in site.posts %}
    {% if p.url == page.url %}{% continue %}{% endif %}
    {% assign is_related = false %}
    {% if page.tags and p.tags %}
      {% for t in page.tags %}
        {% if p.tags contains t %}{% assign is_related = true %}{% break %}{% endif %}
      {% endfor %}
    {% endif %}
    {% if is_related == false and page.categories and p.categories %}
      {% for c in page.categories %}
        {% if p.categories contains c %}{% assign is_related = true %}{% break %}{% endif %}
      {% endfor %}
    {% endif %}
    {% if is_related %}
      {% assign related = related | push: p %}
    {% endif %}
    {% if related.size >= 5 %}{% break %}{% endif %}
  {% endfor %}
  {% if related.size > 0 %}
  <section class="related-posts">
    <h2>相关阅读</h2>
    <ul>
      {% for r in related %}
        <li><a href="{{ r.url | relative_url }}">{{ r.title }}</a> <small>({{ r.date | date: "%Y-%m-%d" }})</small></li>
      {% endfor %}
    </ul>
  </section>
  {% endif %}

  <footer class="post-footer">
    <nav class="post-pager" aria-label="Post Navigation">
      {% if page.previous %}
        <a class="prev" href="{{ page.previous.url | relative_url }}" rel="prev">← 上一篇：{{ page.previous.title }}</a>
      {% endif %}
      {% if page.next %}
        <a class="next" href="{{ page.next.url | relative_url }}" rel="next">下一篇：{{ page.next.title }} →</a>
      {% endif %}
    </nav>
    <div class="share">
      <a href="https://twitter.com/intent/tweet?text={{ page.title | uri_escape }}&url={{ page.url | absolute_url | uri_escape }}" target="_blank" rel="noopener">Share to X</a>
      <a href="https://www.facebook.com/sharer/sharer.php?u={{ page.url | absolute_url | uri_escape }}" target="_blank" rel="noopener" style="margin-left:12px;">Share to Facebook</a>
      <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ page.url | absolute_url | uri_escape }}" target="_blank" rel="noopener" style="margin-left:12px;">Share to LinkedIn</a>
    </div>

    {% if site.giscus and site.giscus.repo %}
    <section id="comments" style="margin-top: 24px;">
      <script src="https://giscus.app/client.js"
        data-repo="{{ site.giscus.repo }}"
        data-repo-id="{{ site.giscus.repo_id }}"
        data-category="{{ site.giscus.category }}"
        data-category-id="{{ site.giscus.category_id }}"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="{{ site.giscus.theme | default: 'light' }}"
        data-lang="zh-CN"
        crossorigin="anonymous"
        async>
      </script>
    </section>
    {% endif %}
  </footer>
</article>

<button id="back-to-top" title="回到顶部">↑</button>

<script>
// 构建目录
(function(){
  const content = document.getElementById('post-content');
  const toc = document.getElementById('toc');
  if (!content || !toc) return;
  const headings = content.querySelectorAll('h1, h2, h3');
  if (!headings.length) return;
  const ul = document.createElement('ul');
  headings.forEach(h => {
    if (!h.id) h.id = h.textContent.trim().toLowerCase().replace(/\s+/g, '-');
    const li = document.createElement('li');
    li.style.marginLeft = ({H1:0,H2:12,H3:24})[h.tagName] + 'px';
    const a = document.createElement('a');
    a.href = '#' + h.id;
    a.textContent = h.textContent;
    li.appendChild(a);
    ul.appendChild(li);
  });
  const title = document.createElement('div');
  title.textContent = '目录';
  title.style.fontWeight = 'bold';
  title.style.marginBottom = '8px';
  toc.appendChild(title);
  toc.appendChild(ul);
})();

// 代码复制按钮
(function(){
  document.querySelectorAll('pre > code').forEach(code => {
    const pre = code.parentElement;
    const btn = document.createElement('button');
    btn.textContent = '复制';
    btn.className = 'copy-btn';
    btn.onclick = async () => {
      try { await navigator.clipboard.writeText(code.innerText); btn.textContent = '已复制'; setTimeout(()=>btn.textContent='复制',1000);} catch(e) {}
    };
    pre.style.position = 'relative';
    btn.style.position = 'absolute';
    btn.style.right = '8px';
    btn.style.top = '8px';
    pre.appendChild(btn);
  });
})();

// 回到顶部
(function(){
  const btn = document.getElementById('back-to-top');
  const onscroll = () => { btn.style.display = window.scrollY > 300 ? 'block' : 'none'; };
  window.addEventListener('scroll', onscroll); onscroll();
  btn.onclick = () => window.scrollTo({top:0, behavior:'smooth'});
})();

// 图片懒加载与缺失 alt 自动补全
(function(){
  document.querySelectorAll('#post-content img').forEach(img => {
    img.loading = 'lazy';
    if (!img.hasAttribute('alt') || img.getAttribute('alt') === '') {
      try {
        const u = new URL(img.src, window.location.origin);
        const name = (u.pathname.split('/').pop() || '').split('.')[0];
        if (name) img.setAttribute('alt', decodeURIComponent(name));
      } catch (e) {}
    }
  });
})();
</script>

<style>
.post-body{display:flex; gap:24px}
#post-body .breadcrumbs{margin:8px 0 12px 0}
#toc{min-width:200px; max-width:240px; position:sticky; top:80px; height:max-content}
#post-content{flex:1}
#back-to-top{position:fixed; right:16px; bottom:24px; display:none; padding:8px 10px}
.copy-btn{font-size:12px; padding:2px 6px}
 .post-pager{display:flex; justify-content:space-between; margin:16px 0}
 .post-pager .prev,.post-pager .next{max-width:48%;}
@media (max-width: 900px){ .post-body{flex-direction:column;} #toc{position:static;}}
</style>

{%- comment -%} 结构化数据：Article {%- endcomment -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": {{ page.title | jsonify }},
  "description": {{ page.description | default: site.description | jsonify }},
  "datePublished": "{{ page.date | date_to_xmlschema }}",
  "dateModified": "{{ page.last_modified_at | default: page.date | date_to_xmlschema }}",
  "author": {
    "@type": "Person",
    "name": {{ site.author.name | default: site.title | jsonify }}
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ page.url | absolute_url }}"
  },
  "url": "{{ page.url | absolute_url }}"
}
</script>

{%- comment -%} 结构化数据：BreadcrumbList {%- endcomment -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {"@type": "ListItem", "position": 1, "name": "首页", "item": "{{ '/' | absolute_url }}"}
    {% if page.categories and page.categories.size > 0 %}
      {% assign pos = 2 %}
      {% for c in page.categories %}
        ,{"@type": "ListItem", "position": {{ pos }}, "name": "{{ c }}", "item": "{{ '/categories/' | absolute_url }}"}
        {% assign pos = pos | plus: 1 %}
      {% endfor %}
    {% else %}
      {% assign pos = 2 %}
    {% endif %}
    ,{"@type": "ListItem", "position": {{ pos }}, "name": {{ page.title | jsonify }}, "item": "{{ page.url | absolute_url }}"}
  ]
}
</script>


